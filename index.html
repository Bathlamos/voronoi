<!--
    Credits to Ivan Kuckir for this demo
-->
<html>
<head>
    <title>Voronoi diagram</title>
    <meta charset="utf-8"/>
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
    </style>

    <script type="text/javascript" src="fibonacci-heap.js"></script>
    <script type="text/javascript" src="voronoi.js"></script>

    <script type="application/javascript">
        var ctx = null;
        var points = [];
        var h = 0, w = 0;

        function onLoad() {
            var canvas = document.getElementById("c");
            canvas.onmousemove = onMM;
            canvas.onclick = onClick;
            ctx = canvas.getContext("2d");
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;

            for (var i = 0; i < 10; i++)
                points.push([Math.random() * w, Math.random() * h]);

            redraw();
        }

        function onMM(e) {
            var last = points[points.length - 1];
            last[0] = e.clientX - e.target.offsetLeft;
            last[1] = e.clientY - e.target.offsetTop;
            redraw();
        }

        function onClick(e) {
            var last = points[points.length - 1];
            last.x += Math.random();
            last.y += Math.random();
            points.push([
                e.clientX - e.target.offsetLeft,
                e.clientY - e.target.offsetTop
            ]);
        }

        function redraw() {
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, w, h);

            var edges = Voronoi.compute(points, w, h).edges;

            ctx.lineWidth = 5;
            ctx.strokeStyle = "#000";
            for (var i = 0; i < edges.length; i++) {
                var e = edges[i];
                ctx.beginPath();
                ctx.moveTo(e.start[0], e.start[1]);
                ctx.lineTo(e.end[0], e.end[1]);
                ctx.closePath();
                ctx.stroke();
            }

            ctx.fillStyle = "rgb(255,0,0)";
            for (i = 0; i < points.length; i++) {
                var p = points[i];
                ctx.beginPath();
                ctx.arc(p[0], p[1], 6, 0, Math.PI * 2, true);
                ctx.closePath();
                ctx.fill();
            }
        }
    </script>
</head>

<body onload="onLoad()">
    <canvas id="c"></canvas>
</body>
</html>